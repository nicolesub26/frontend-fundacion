<div class="space-y-6">
  <!-- Header -->
  <div class="rounded-2xl p-6 text-white bg-gradient-to-r from-indigo-500 to-blue-600 shadow">
    <h1 class="text-2xl font-semibold">Gastos</h1>
    <p class="text-white/80">Filtra, visualiza detalles e imprime</p>
  </div>

  <!-- Filtros -->
  <form [formGroup]="filtroForm" (ngSubmit)="buscar()" class="rounded-2xl bg-white p-5 shadow border border-gray-100 space-y-4">
    <div class="grid md:grid-cols-6 gap-3">
      <div>
        <label class="text-sm font-medium text-gray-700">Desde</label>
        <input type="date" formControlName="desde" class="w-full rounded border border-gray-200 px-3 py-2" />
      </div>
      <div>
        <label class="text-sm font-medium text-gray-700">Hasta</label>
        <input type="date" formControlName="hasta" class="w-full rounded border border-gray-200 px-3 py-2" />
      </div>
      <div>
        <label class="text-sm font-medium text-gray-700">Tipo</label>
        <select formControlName="idTipoGasto" class="w-full rounded border border-gray-200 px-3 py-2 bg-white">
          <option [ngValue]="null">Todos</option>
          <option *ngFor="let t of tipos()" [ngValue]="t.idTipoGasto">{{ t.descripcion }}</option>
        </select>
      </div>
      <div>
        <label class="text-sm font-medium text-gray-700">Empleado</label>
        <select formControlName="idEmpleado" class="w-full rounded border border-gray-200 px-3 py-2 bg-white">
          <option [ngValue]="null">Todos</option>
          <option *ngFor="let e of empleados()" [ngValue]="e.id">{{ e.nombre }} {{ e.apellido }}</option>
        </select>
      </div>
      <div>
        <label class="text-sm font-medium text-gray-700">Estado</label>
        <select formControlName="estado" class="w-full rounded border border-gray-200 px-3 py-2 bg-white">
          <option [ngValue]="null">Todos</option>
          <option [ngValue]="1">Activo</option>
          <option [ngValue]="0">Inactivo</option>
        </select>
      </div>
      <div>
        <label class="text-sm font-medium text-gray-700">Texto</label>
        <input formControlName="texto" placeholder="Descripción/Comprobante" class="w-full rounded border border-gray-200 px-3 py-2" />
      </div>
    </div>

    <div class="flex items-center gap-2 pt-2">
      <button type="submit" class="rounded-xl bg-indigo-600 text-white px-4 py-2 font-medium hover:bg-indigo-700">
        {{ loading() ? 'Buscando…' : 'Buscar' }}
      </button>
      <button type="button" (click)="limpiarFiltros()" class="rounded-xl bg-gray-100 text-gray-700 px-4 py-2 font-medium hover:bg-gray-200">
        Limpiar
      </button>

      <div class="ml-auto flex items-center gap-2">
        <button type="button" (click)="imprimirListado()" class="rounded-xl bg-emerald-600 text-white px-4 py-2 font-medium hover:bg-emerald-700">
          Imprimir listado
        </button>
        <select class="rounded border px-2 py-2"
        [value]="pageSize()"
        (change)="onPageSizeChange($event)">
  <option [value]="5">5</option>
  <option [value]="10">10</option>
  <option [value]="20">20</option>
  <option [value]="50">50</option>
</select>

      </div>
    </div>
  </form>

  <!-- Tabla -->
  <div class="rounded-2xl bg-white shadow border border-gray-100 overflow-hidden">
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr class="text-left text-xs font-semibold text-gray-600">
            <th class="px-4 py-3">ID</th>
            <th class="px-4 py-3">Fecha</th>
            <th class="px-4 py-3">Descripción</th>
            <th class="px-4 py-3">Comprobante</th>
            <th class="px-4 py-3">Tipo</th>
            <th class="px-4 py-3">Empleado</th>
            <th class="px-4 py-3 text-right">Monto</th>
            <th class="px-4 py-3 text-center">Acciones</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100 text-sm">
          <tr *ngFor="let g of pageData()" class="hover:bg-gray-50">
            <td class="px-4 py-3">{{ g.idGasto }}</td>
            <td class="px-4 py-3">{{ g.fechaGasto }}</td>
            <td class="px-4 py-3">{{ g.descripcion }}</td>
            <td class="px-4 py-3">{{ g.comprobante }}</td>
          <td class="px-4 py-3">{{ g?.tipoGasto?.idTipoGasto || g?.tipoGasto?.idTipoGasto }}</td>
<td class="px-4 py-3">{{ g?.empleado?.id }}</td>

<td class="px-4 py-3 text-right">{{ (g.monto ?? 0) | number:'1.2-2' }}</td>
            <td class="px-4 py-3">
              <div class="flex items-center justify-center gap-2">
                <button (click)="verDetalle(g)" class="rounded-lg bg-sky-600 text-white px-3 py-1.5 hover:bg-sky-700">Detalle</button>
                <button (click)="imprimirGasto(g)" class="rounded-lg border px-3 py-1.5 hover:bg-gray-100">Imprimir</button>
              </div>
            </td>
          </tr>
          <tr *ngIf="!loading() && listFiltrada().length === 0">
            <td colspan="8" class="px-4 py-6 text-center text-gray-500">Sin resultados</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Totales -->
    <div class="px-5 py-4 bg-gray-50 flex justify-end">
      <div class="text-right">
        <div class="text-sm text-gray-600">Total listado</div>
        <div class="text-xl font-semibold">{{ totalListado() | number:'1.2-2' }}</div>
      </div>
    </div>

    <!-- Paginación -->
    <div class="px-5 py-4 flex items-center justify-between">
      <div class="text-sm text-gray-600">
        Página {{ page() }} de {{ pageCount() }} • {{ listFiltrada().length }} resultados
      </div>
      <div class="flex items-center gap-2">
        <button class="rounded border px-3 py-1.5" (click)="goTo(page()-1)" [disabled]="page()<=1">Anterior</button>
        <button class="rounded border px-3 py-1.5" (click)="goTo(page()+1)" [disabled]="page()>=pageCount()">Siguiente</button>
      </div>
    </div>
  </div>

  <!-- Modal de detalle -->
  <div *ngIf="detalleOpen()" class="fixed inset-0 bg-black/40 z-50 flex items-center justify-center p-4">
    <div class="w-full max-w-4xl bg-white rounded-2xl shadow-lg overflow-hidden">
      <div class="px-5 py-4 bg-gray-50 flex items-center justify-between">
        <h2 class="font-semibold text-gray-800">
          Gasto #{{ detalleCab()?.idGasto }} — {{ detalleCab()?.fechaGasto }}
        </h2>
        <button (click)="cerrarDetalle()" class="rounded-lg border px-3 py-1.5 hover:bg-gray-100">Cerrar</button>
      </div>
      <div class="p-5 space-y-3">
        <div class="grid md:grid-cols-3 gap-3 text-sm">
          <div><span class="text-gray-600">Descripción:</span> {{ detalleCab()?.descripcion }}</div>
          <div><span class="text-gray-600">Comprobante:</span> {{ detalleCab()?.comprobante || '—' }}</div>
          <div><span class="text-gray-600">Tipo:</span>
  {{ detalleCab()?.tipoGasto?.idTipoGasto || detalleCab()?.tipoGasto?.idTipoGasto }}
</div>
<div><span class="text-gray-600">Empleado:</span>
  {{ detalleCab()?.empleado?.id || detalleCab()?.empleado?.id }}
</div>

<div><span class="text-gray-600">Monto:</span> {{ (detalleCab()?.monto ?? 0) | number:'1.2-2' }}</div>
        </div>

        <div class="overflow-auto">
          <table class="min-w-full border mt-2">
            <thead class="bg-gray-100">
              <tr>
                <th class="p-2 text-left">Artículo</th>
                <th class="p-2 text-left">Descripción</th>
                <th class="p-2 text-right">Cant.</th>
                <th class="p-2 text-right">Precio</th>
                <th class="p-2 text-right">Subtotal</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let d of detalleLin()" class="border-t">
                <td class="p-2">{{ d.articulo?.idArticulo }}</td>
                <td class="p-2">{{ d.descripcion || '—' }}</td>
                <td class="p-2 text-right">{{ d.cantidadComprada | number:'1.0-2' }}</td>
                <td class="p-2 text-right">{{ d.precioUnitario | number:'1.2-2' }}</td>
                <td class="p-2 text-right">{{ (d.cantidadComprada * d.precioUnitario) | number:'1.2-2' }}</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="flex justify-end">
          <button (click)="imprimirGasto(detalleCab()!)" class="rounded-xl bg-emerald-600 text-white px-4 py-2 font-medium hover:bg-emerald-700">
            Imprimir este gasto
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
